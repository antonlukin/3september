!function(){var t=null,n=Date.now(),o=document.getElementById("calendar"),r=document.getElementById("sound"),a=document.getElementById("video"),i=0;function c(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function d(e){return 9<e&&e<20||e%10<2||4<e%10?c(e)+" раз":c(e)+" раза"}function e(){(t=new WebSocket("wss://3september.ru:8000")).onmessage=function(e){var t=document.querySelector(".counter--more");t.querySelector("strong").innerHTML=d(e.data),t.classList.remove("counter--hidden")},t.onclose=function(){!function(){if(!t||t.readyState==WebSocket.CLOSED)e()}()},t.onerror=function(e){console.error("WebSocket error observed: ",e)}}function l(){localStorage.setItem("count",++i);var e=document.querySelector(".counter--title");e.querySelector("strong").innerHTML=d(i),e.classList.remove("counter--hidden");var t=o.querySelector(".calendar__page:last-child");t.classList.add("calendar__page--animate"),t.addEventListener("animationend",function e(){t.classList.remove("calendar__page--animate"),t.removeEventListener("animationend",e)})}function s(e,t){e=e.split("");for(var n,o,r=0,a=0;r<3*e.length;r++){var i=(n=10,o=15,n=Math.ceil(n),o=Math.floor(o),(Math.floor(Math.random()*(o-n+1))+n).toString(16));r%3==1&&(i=(9-e[a++]).toString()),t+=i}return t}r.addEventListener("click",function(e){return e.preventDefault(),r.classList.add("sound--stop","sound--clicked"),a.muted?(r.classList.remove("sound--stop"),a.muted=!1):a.muted=!0}),o.addEventListener("click",function(e){if(e.preventDefault(),1500<Date.now()-n)return n=Date.now(),t&&t.readyState==WebSocket.OPEN&&t.send("update"),!r.classList.contains("sound--clicked")&&a.muted&&r.click(),l()}),setInterval(function(){t&&t.readyState==WebSocket.OPEN&&t.send("receive")},5e3),localStorage.getItem("count")&&(i=parseInt(localStorage.getItem("count"))),window.addEventListener("load",l);for(var u=document.querySelectorAll(".share"),h=0;h<u.length;h++)u[h].addEventListener("click",function(e){return e.preventDefault(),function(e,t,n){e=e+"/social/"+s(i.toString(),"");var o=(o=document.querySelector(".counter--title").textContent).trim()+" и снова третье сентября";0<=["vkontakte","odnoklassniki"].indexOf(t)&&(e=e+"&title="+encodeURIComponent(o)),0<=["twitter","telegram"].indexOf(t)&&(e=e+"&text="+encodeURIComponent(o));var r=Math.round(screen.width/2-n.width/2),a=0;return screen.height>n.height&&(a=Math.round(screen.height/3-n.height/2)),window.open(e,n.id,"left="+r+",top="+a+",width="+n.width+",height="+n.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1")}(this.href,this.dataset.label,{width:600,height:400,id:this.dataset.label})});e()}();