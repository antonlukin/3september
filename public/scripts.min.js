!function(){var t=null,n=Date.now(),o=document.getElementById("calendar"),r=document.getElementById("sound"),a=document.getElementById("audio"),c=!1,d=0;function u(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function i(e){return 9<e&&e<20?u(e)+" раз":e%10<2||4<e%10?u(e)+" раз":u(e)+" раза"}function e(){(t=new WebSocket("wss://3september.ru:8000")).onmessage=function(e){var t=document.querySelector(".counter--more");t.querySelector("strong").innerHTML=i(e.data),t.classList.remove("counter--hidden")},t.onclose=function(){!function(){if(!t||t.readyState==WebSocket.CLOSED)e()}()},t.onerror=function(e){console.error("WebSocket error observed: ",e)}}function s(){localStorage.setItem("count",++d);var e=document.querySelector(".counter--title");e.querySelector("strong").innerHTML=i(d),e.classList.remove("counter--hidden");var t=o.querySelector(".calendar__page:last-child");t.classList.add("calendar__page--animate"),t.addEventListener("animationend",function e(){t.classList.remove("calendar__page--animate"),t.removeEventListener("animationend",e)})}r.addEventListener("click",function(e){return e.preventDefault(),c=!0,document.getElementById("audio").paused?(c=!1,a.play()):a.pause()}),a.addEventListener("pause",function(){r.classList.add("sound--stop")}),a.addEventListener("playing",function(){r.classList.remove("sound--stop")}),o.addEventListener("click",function(e){if(e.preventDefault(),1500<Date.now()-n)return n=Date.now(),t&&t.readyState==WebSocket.OPEN&&t.send("update"),!c&&document.getElementById("audio").paused&&r.click(),s()}),setInterval(function(){t&&t.readyState==WebSocket.OPEN&&t.send("receive")},5e3),localStorage.getItem("count")&&(d=parseInt(localStorage.getItem("count"))),window.addEventListener("load",function(){return s()}),e()}();
!function(){for(var e=document.querySelectorAll(".share"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){return e.preventDefault(),h=this.href,o=this.dataset.label,a=(a=document.querySelector(".counter--title").textContent).trim()+" и снова третье сентября",t=0<=["vkontakte","odnoklassniki"].indexOf(o)?h+"&title="+encodeURIComponent(a):0<=["twitter","telegram"].indexOf(o)?h+"&text="+encodeURIComponent(a):h,n={width:600,height:400,id:this.dataset.label},i=Math.round(screen.width/2-n.width/2),r=0,screen.height>n.height&&(r=Math.round(screen.height/3-n.height/2)),window.open(t,n.id,"left="+i+",top="+r+",width="+n.width+",height="+n.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");var t,n,i,r,h,o,a})}();