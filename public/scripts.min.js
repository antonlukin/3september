!function(){var e=null,r=Date.now(),n=document.getElementById("calendar"),a=document.getElementById("sound"),o=document.getElementById("video"),i=document.getElementById("micro"),c=document.getElementById("karaoke"),s=0;function l(e){var t=[" раз"," раза"," раз"][4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]];return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+t}function t(){(e=new WebSocket("wss://3september.ru/receive/")).onmessage=function(e){var t=document.querySelector(".counter--more");t.querySelector("strong").innerHTML=l(e.data),t.classList.remove("counter--hidden")},e.onclose=function(){!function(){if(!e||e.readyState==WebSocket.CLOSED)t()}()},e.onerror=function(e){console.error("WebSocket error observed: ",e)}}function d(){localStorage.setItem("count",++s);var e=document.querySelector(".counter--title");e.querySelector("strong").innerHTML=l(s),e.classList.remove("counter--hidden");var t=n.querySelector(".calendar__page:last-child");t.classList.add("calendar__page--animate"),t.addEventListener("animationend",function e(){t.classList.remove("calendar__page--animate"),t.removeEventListener("animationend",e)})}function u(e,t){e=e.split("");for(var n,r,a=0,o=0;a<3*e.length||a<10;a++){var i=(n=10,r=15,n=Math.ceil(n),r=Math.floor(r),(Math.floor(Math.random()*(r-n+1))+n).toString(16));a%3==1&&o<e.length&&(i=(9-e[o++]).toString()),t+=i}return t}i.addEventListener("click",function(e){i.classList.toggle("micro--active");var t=i.classList.contains("micro--active");c.classList.toggle("karaoke--active",t),a.classList.remove("sound--stop"),o.muted=!1}),a.addEventListener("click",function(e){return e.preventDefault(),a.classList.add("sound--stop","sound--clicked"),o.muted?(a.classList.remove("sound--stop"),o.muted=!1):o.muted=!0}),o.addEventListener("timeupdate",function(){for(var e=c.querySelectorAll("p"),t=0;t<e.length;t++){var n=parseFloat(e[t].getAttribute("data-start")),r=t<e.length-1?parseFloat(e[t+1].getAttribute("data-start")):o.duration;o.currentTime>=n&&o.currentTime<=r?e[t].classList.add("karaoke__line--active"):e[t].classList.remove("karaoke__line--active")}}),n.addEventListener("click",function(e){e.preventDefault();var t=JSON.stringify({data:"counter"});if(1500<Date.now()-r){r=Date.now();var n=new XMLHttpRequest;return n.open("POST","https://3september.ru/update/"),n.setRequestHeader("Content-type","application/json"),n.send(t),!a.classList.contains("sound--clicked")&&o.muted&&a.click(),d()}}),setInterval(function(){e&&e.readyState==WebSocket.OPEN&&e.send("counter")},5e3),localStorage.getItem("count")&&(s=parseInt(localStorage.getItem("count")));var g=new Image;g.src="/images/calendar.jpg",g.onload=function(){for(var e=n.querySelectorAll(".calendar__page-front"),t=0;t<e.length;t++)e[t].style.backgroundImage="url("+g.src+")";setTimeout(d,500)};for(var m=document.querySelectorAll(".share"),v=0;v<m.length;v++)m[v].addEventListener("click",function(e){return e.preventDefault(),function(e,t){e=e+"/social/"+u(s.toString(),"");var n=Math.round(screen.width/2-t.width/2),r=0;return screen.height>t.height&&(r=Math.round(screen.height/3-t.height/2)),window.open(e,t.id,"left="+n+",top="+r+",width="+t.width+",height="+t.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1")}(this.href,(this.dataset.label,{width:600,height:400,id:this.dataset.label}))});t()}();